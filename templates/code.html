<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>احراز شماره</title>
  </head>
  <body>
    <div class="verify-container">
      <div class="verify-left"></div>
      {% load static %}
      <style>
        @font-face {
          font-family: "Vazirmatn";
          src: url("{% static 'fonts/Vazirmatn-VariableFont_wght.ttf' %}") format("truetype");
        }
        html {
          font-family: "Vazirmatn", sans-serif;
        }
        body {
          margin: 0;
          direction: rtl;
          padding-right: 90px;
          background: #f5f7f9;
          color: #0a2342;
        }
        .verify-container {
          display: flex;
          min-height: 100vh;
        }
        .sitename {
          text-align: center;
          margin-bottom: 174px;
        }
      </style>

      <div class="verify-right">
        <h1 class="sitename">اسم سایت</h1>

        <div class="verify-card">
          <h1 class="verify-title">احراز شماره تلفن همراه</h1>

          <p class="verify-hint">
            کد تایید ارسال‌شده به شماره
            <span class="verify-phone">{{phone_number}}</span>
            را وارد کنید.
          </p>

          <!-- فرم کامل و اصلاح‌شده -->
          <form method="post" class="verify-form" action="{% url 'verify_otp' %}">
            {% csrf_token %}

            <!-- شماره موبایل صحیح (اصلاح‌شده) -->
            <input type="hidden" name="phonenumber" value="{{ phone_number }}" />

            <div class="verify-otp-row">
              <input type="text" maxlength="1" autocomplete="off" class="verify-otp-input" inputmode="numeric" pattern="[0-9]*" name="digit1" required />
              <input type="text" maxlength="1" autocomplete="off" class="verify-otp-input" inputmode="numeric" pattern="[0-9]*" name="digit2" required />
              <input type="text" maxlength="1" autocomplete="off" class="verify-otp-input" inputmode="numeric" pattern="[0-9]*" name="digit3" required />
              <input type="text" maxlength="1" autocomplete="off" class="verify-otp-input" inputmode="numeric" pattern="[0-9]*" name="digit4" required />
            </div>

            <a href="{% url 'home' %}" class="verify-change-number">
              تغییر شماره موبایل
            </a>

            <button type="submit" class="btn btn-confirm" style="margin-top: 40px;">
              تایید
            </button>
          </form>

          <style>
            .verify-form {
              margin-bottom: 20px;
            }
            .verify-card {
              text-align: center;
              padding: 79px 71px 68px 78px;
              border-radius: 50px;
              box-shadow: 0px 10px 25px rgba(0, 0, 0, 0.1);
            }
            .verify-title {
              margin: 0;
            }
            .verify-otp-input {
              height: 67px;
              width: 72px;
              border-radius: 16px;
              border: 4px solid #234f77;
              box-shadow: 10px 10px 10px 5px rgba(66, 65, 65, 0.1) inset;
              font-size: 40px;
              text-align: center;
            }
            .verify-change-number {
              display: block;
              text-align: center;
              margin-top: 48px;
              color: #4e7bac;
              margin-left: 296px;
              text-decoration: underline;
              font-size: 17px;
            }
            .verify-hint {
              margin: 0;
              padding: 35px 0;
            }
            .actions {
              display: flex;
              gap: 18px;
              justify-content: center;
              margin-top: 48px;
              align-items: center;
              flex-wrap: wrap;
            }
            .btn {
              width: 238px;
              height: 74px;
              border-radius: 23px;
            }
            .btn-resend {
              border: 0;
              background-color: #8fb3d8;
              color: #4e7bac;
              font-size: 20px;
            }
            .btn-confirm {
              color: #0a2342;
              font-size: 31px;
              border: 4px solid #27a79c;
              background-color: #30c7b9;
            }
          </style>
        </div>

        <div class="actions">
          <button type="button" class="btn btn-resend" id="resend-btn" disabled>
            ارسال مجدد کد 60 ثانیه
          </button>
        </div>
      </div>
    </div>

    <script>
      const inputs = document.querySelectorAll(".verify-otp-input");

      inputs.forEach((input, index) => {
        input.addEventListener("input", (e) => {
          let value = e.target.value.replace(/\D/g, "");
          e.target.value = value;

          if (value && index < inputs.length - 1) {
            inputs[index + 1].focus();
          }
        });

        input.addEventListener("keydown", (e) => {
          if (e.key === "Backspace" && !input.value && index > 0) {
            inputs[index - 1].focus();
          }
        });

        input.addEventListener("focus", (e) => {
          setTimeout(() => {
            input.selectionStart = input.selectionEnd = input.value.length;
          }, 0);
        });
      });
    </script>
  </body>
</html>
